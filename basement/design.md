# brickyard3 设计文档

## 激发

首先，整个架构是基于以往 brickyard 对插件代码的管理演化而来的。

其次，基于命令工具的扩展设计是参考 [百度的fis3](fex-team.github.io/fis3/)。

## 具体

### 配置管理

配置管理方面应用了多级覆盖的思想，可以非常自由地分级管理具体配置，应用于不同环境下。

### 子命令管理

应用到依赖倒置的设计思想。

本应该是*子命令**强依赖**核心库*，运行时主动调用核心库的工具来实现功能。

但现在设计成是*核心库主动发现子命令*（依照特定的命名规则）.子命令只是根据接收的运行时对象, 来根据其中信息自定义处理逻辑。

其实也类似于监听器模式。

### 插件管理

插件的管理其实跟子命令模块的发现类似，根据运行时配置到指定的插件目录（默认是`[repo]/bricks`）, 搜索所有的`package.json`文件（会忽略`node_modules`及`bower_components`目录）。再抽取配置指定的插件的配置数据。再融合到运行时对象中，提供给子命令使用。

### 组装计划管理

其管理部分归于配置管理，部分归于插件管理

### 命令行工具管理

命令行工具的实现思路也是参考 FIS3。
使用了`Liftoff`以及`commander`。两者结合基本应付所有相关问题。

### 日志管理工具

使用了`log4js`，方便地实现基于模块的运行时日志输出。
